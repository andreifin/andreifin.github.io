"use strict";angular.module("previewGruntApp",["ngAnimate","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/links",{templateUrl:"views/links.html",controller:"LinksCtrl"}).when("/levels",{templateUrl:"views/levelSelect.html",controller:"SelectCtrl"}).when("/levels/:levelId",{templateUrl:"views/gameview.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("previewGruntApp").controller("LinksCtrl",["$scope",function(a){a.links=["http://www.google.co.uk","http://mail.yahoo.com"]}]),angular.module("previewGruntApp").controller("SelectCtrl",["$scope",function(a){a.levels=[[2,2],[2,6,3],[2,3,4,6],[6,10,15],[2,12,10,30,2],[3,6,4,12,14,42,2],[6,6,6,6,9],[4,4,6,6,9],[14,22,30,105,198],[4,4,8,8],[4,6,12,18],[2,4,8],[3,9,27],[125,25,125],[10,15,22,33],[14,15,30,63],[4,36,9],[4,4,7,7,10,84,840],[5,6,9,10,12],[2,4,6,9,14,30,315],[44,63,180,385]]}]),angular.module("previewGruntApp").controller("GameCtrl",["$scope","$routeParams",function(a,b){var c;c=require("prelude-ls").unique,a.levels=[[2,2],[2,6,3],[2,3,4,6],[6,10,15],[12,10,30],[3,6,4,12,14,21],[6,6,6,6,9],[4,4,6,6,9],[14,22,30,105,198],[4,4,8,8],[4,6,12,18],[2,4,8],[3,9,27],[125,25,125],[10,15,22,33],[14,15,30,63],[4,36,9],[4,4,7,7,10,84,840],[5,6,9,10,12],[2,4,6,9,14,30,315],[44,63,180,385]];var d,e,f;a.currentLevel=b.levelId-1,a.startingNums=a.levels[a.currentLevel],a.numbers=a.startingNums.concat([]),a.winFlag=!1,a.loseFlag=!1,a.prev=-1,a.hasContinue=!1,a.hist=[],a.histPrev=[];var g=function(a,b){var c=a.length;if(c!==b.length)return!1;for(;c>=0;){if(a[c]!==b[c])return!1;c--}return!0};return d=function(a,b){var c,e,f;if(a>b)return d(b,a);for(c=a,e=Math.floor(a/2);e>=2;--e)f=e,a%f===0&&b%f===0&&(c=f);return c===a&&b%a!==0&&(c=1),c},e=function(){return 1===c(a.numbers).length&&1===a.numbers[0]?a.winFlag=!0:a.loseFlag=!0},f=function(b){a.hasContinue=a.hasContinue||d(a.numbers[a.prev],b)>1},a.handleDrop=function(b,c){var g;if(b===c)return void console.log(b,c);if(b==a.prev||-1===a.prev){if(g=d(a.numbers[b],a.numbers[c]),1===g)return;a.hist.unshift(a.numbers.concat([])),a.histPrev.unshift(a.prev+""),a.numbers[b]/=g,a.numbers[c]/=g,a.prev=c}if(1===a.numbers[a.prev])return e();a.hasContinue=!1;var h=a.numbers.concat([]);h.splice(a.prev,1),h.forEach(f),a.hasContinue===!1&&(a.loseFlag=!0)},a.undo=function(){0!==a.hist.length&&(a.prev=parseInt(a.histPrev[0]+""),a.histPrev.splice(0,1),a.numbers=a.hist[0].concat([]),a.hist.splice(0,1),a.winFlag=!1,a.loseFlag=!1,g(a.numbers,a.startingNums)&&a.reset())},a.findPos=function(a){var b,c;if(b=c=0,a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return[b,c]},a.checkCollisions=function(b,c){var d;for(d=0;d<a.numbers.length;d++){var e=document.getElementById(d),f=a.findPos(e),g=f[0],h=f[1];if(console.log(g,h,b,c),b>g&&g+40>b&&c>h&&h+40>c)return d}return-1},a.reset=function(){return a.prev=-1,a.winFlag=!1,a.loseFlag=!1,a.hist=[],a.histPrev=[],a.numbers=a.startingNums.concat([])}}]).directive("draggable",function(){return{scope:!0,link:function(a,b){var c=b[0];c.draggable=!0,c.addEventListener("dragstart",function(b){return-1==a.prev||this.id==a.prev?(b.dataTransfer.effectAllowed="move",this.style.opacity="0.4",b.dataTransfer.setData("Text",this.id),this.classList.add("drag"),!1):void 0},!1),c.addEventListener("touchstart",function(b){return console.log(b),-1==a.prev||this.id==a.prev?(this.style.opacity="0.4",this.classList.add("drag"),!1):void 0},!1),c.addEventListener("dragend",function(){return this.style.opacity="1.0",this.classList.remove("drag"),!1},!1),c.addEventListener("touchend",function(b){console.log(b),this.style.opacity="1.0",this.classList.remove("drag"),console.log(a.findPos(this));var c=a.checkCollisions(b.changedTouches[0].clientX,b.changedTouches[0].clientY);return console.log(c),a.$apply(a.handleDrop(parseInt(this.id),c)),!1},!1)}}}).directive("droppable",function(){return{scope:{drop:"&",bin:"="},link:function(a,b){var c=b[0];c.addEventListener("dragover",function(a){return a.dataTransfer.dropEffect="move",a.preventDefault&&a.preventDefault(),this.classList.add("over"),!1},!1),c.addEventListener("dragenter",function(){return this.classList.add("over"),!1},!1),c.addEventListener("dragleave",function(){return this.classList.remove("over"),!1},!1),c.addEventListener("drop",function(b){b.stopPropagation&&b.stopPropagation(),this.classList.remove("over");var c=this.id,d=document.getElementById(b.dataTransfer.getData("Text"));return a.$apply(function(a){var b=a.drop();"undefined"!=typeof b&&b(d.id,c)}),!1},!1)}}});